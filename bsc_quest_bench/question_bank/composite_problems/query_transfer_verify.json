{
  "id": "composite_query_transfer_verify",
  "version": "2.0.0",
  "category": "composite_problems",
  "subcategory": "basic_workflows",
  "difficulty": "medium",
  "title": "Query-Transfer-Verify Workflow",
  
  "description": [
    "A composite problem that combines balance query, token transfer, and balance verification.",
    "",
    "This tests the LLM's ability to:",
    "1. Query the initial ERC20 token balance",
    "2. Execute a token transfer",
    "3. Query the final balance to verify the transfer",
    "",
    "The composite validation will:",
    "- Validate each atomic operation independently (using existing validators)",
    "- Calculate the total score as the average of atomic scores",
    "- Optionally verify balance consistency across operations"
  ],
  
  "natural_language_templates": [
    "Check your {token_symbol} balance, transfer {amount} {token_symbol} to {to_address}, then verify your new balance",
    "First, see how many {token_symbol} tokens you have. Then send {amount} {token_symbol} to {to_address}. Finally, check your updated balance",
    "Query your {token_symbol} balance, transfer {amount} {token_symbol} to {to_address}, and confirm the balance changed correctly"
  ],
  
  "blockchain": {
    "chain": "BSC",
    "network": "mainnet"
  },
  
  "composite_structure": {
    "atomic_operations": [
      {
        "step": 1,
        "atomic_id": "query_erc20_balance",
        "alias": "pre_balance_query",
        "description": "Query initial token balance"
      },
      {
        "step": 2,
        "atomic_id": "erc20_transfer_fixed",
        "alias": "token_transfer",
        "description": "Transfer tokens to recipient"
      },
      {
        "step": 3,
        "atomic_id": "query_erc20_balance",
        "alias": "post_balance_query",
        "description": "Query final token balance to verify transfer"
      }
    ],
    "validation_mode": "sequential_atomic",
    "scoring_method": "average",
    "inter_operation_checks": [
      {
        "type": "balance_decrease",
        "description": "Verify balance decreased by transfer amount",
        "weight": 0.1,
        "check": "post_balance = pre_balance - amount (within gas tolerance)"
      }
    ]
  },
  
  "parameters": {
    "token_address": {
      "type": "address",
      "role": "contract",
      "description": "ERC20 token contract address",
      "shared_across_steps": [1, 2, 3],
      "generation": {
        "method": "from_list",
        "addresses": ["0x55d398326f99059fF775485246999027B3197955"],
        "comment": "BSC Mainnet USDT"
      }
    },
    "token_symbol": {
      "type": "string",
      "role": "display",
      "description": "Token symbol for display",
      "shared_across_steps": [1, 2, 3],
      "generation": {
        "method": "fixed",
        "value": "USDT"
      }
    },
    "token_decimals": {
      "type": "integer",
      "role": "calculation",
      "description": "Token decimal places",
      "shared_across_steps": [1, 2, 3],
      "generation": {
        "method": "fixed",
        "value": 18
      }
    },
    "query_address": {
      "type": "address",
      "role": "query_target",
      "description": "Address to query balance for (agent's own address)",
      "shared_across_steps": [1, 3],
      "generation": {
        "method": "agent_address",
        "comment": "Query agent's own balance"
      }
    },
    "to_address": {
      "type": "address",
      "role": "receiver",
      "description": "Recipient address for transfer",
      "used_in_step": 2,
      "generation": {
        "method": "random"
      }
    },
    "amount": {
      "type": "number",
      "role": "transfer_amount",
      "description": "Transfer amount in tokens",
      "used_in_step": 2,
      "generation": {
        "method": "random",
        "min": 1.0,
        "max": 10.0,
        "decimals": 2
      }
    }
  },
  
  "validation": {
    "pre_conditions": [
      {
        "type": "token_balance",
        "description": "Agent must have sufficient token balance",
        "min_balance": "200 tokens"
      }
    ],
    "post_conditions": [
      {
        "type": "composite_success",
        "weight": 1.0,
        "description": "All atomic operations validated using their respective validators",
        "method": "sequential_atomic_validation"
      }
    ]
  },
  
  "metadata": {
    "tags": ["composite", "query", "transfer", "verify", "workflow", "basic"],
    "estimated_gas": 150000,
    "requires_contract": true,
    "composite_type": "sequential",
    "atomic_count": 3,
    "difficulty_notes": [
      "Tests ability to chain multiple operations",
      "Requires understanding of state changes",
      "Demonstrates query-action-verify pattern"
    ]
  }
}

