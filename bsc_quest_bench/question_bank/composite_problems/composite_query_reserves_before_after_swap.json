{
  "id": "composite_query_reserves_before_after_swap",
  "category": "composite_problems",
  "difficulty": "medium",
  "title": "Query Reserves, Swap BNB for Tokens, and Verify Reserves Changed",
  "description": [
    "A composite problem that tests the LLM's ability to:",
    "1. Query initial liquidity pair reserves",
    "2. Execute a BNB to token swap on PancakeSwap",
    "3. Query final liquidity pair reserves to verify the swap affected reserves"
  ],
  "natural_language_templates": [
    "Check the reserves of {token_symbol}/BNB pair, swap {amount} BNB for {token_symbol}, then verify reserves changed",
    "Query pair reserves at {pair_address}, execute swap, and confirm the reserves updated correctly"
  ],
  "blockchain": {
    "chain": "BSC",
    "network": "mainnet"
  },
  "composite_structure": {
    "atomic_operations": [
      {
        "step": 1,
        "atomic_id": "query_pair_reserves",
        "description": "Query initial pair reserves"
      },
      {
        "step": 2,
        "atomic_id": "swap_exact_bnb_for_tokens",
        "description": "Swap BNB for tokens"
      },
      {
        "step": 3,
        "atomic_id": "query_pair_reserves",
        "description": "Query final pair reserves"
      }
    ]
  },
  "parameters": {
    "pair_address": {
      "type": "address",
      "role": "contract",
      "description": "PancakeSwap WBNB/USDT pair address",
      "shared_across_steps": [1, 3],
      "generation": {
        "method": "fixed",
        "value": "0x16b9a82891338f9bA80E2D6970FddA79D1eb0daE",
        "comment": "WBNB/USDT LP pair on BSC"
      }
    },
    "router_address": {
      "type": "address",
      "role": "contract",
      "description": "PancakeSwap V2 Router address",
      "shared_across_steps": [2],
      "generation": {
        "method": "fixed",
        "value": "0x10ED43C718714eb63d5aA57B78B54704E256024E"
      }
    },
    "token_address": {
      "type": "address",
      "role": "token_out",
      "description": "Token to receive (USDT)",
      "shared_across_steps": [2],
      "generation": {
        "method": "fixed",
        "value": "0x55d398326f99059fF775485246999027B3197955",
        "comment": "USDT on BSC"
      }
    },
    "token_symbol": {
      "type": "string",
      "role": "display",
      "description": "Token symbol for display",
      "shared_across_steps": [2],
      "generation": {
        "method": "fixed",
        "value": "USDT"
      }
    },
    "wbnb_address": {
      "type": "address",
      "role": "token_in",
      "description": "WBNB address",
      "shared_across_steps": [2],
      "generation": {
        "method": "fixed",
        "value": "0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c"
      }
    },
    "amount": {
      "type": "number",
      "unit": "BNB",
      "role": "swap_amount",
      "description": "Amount of BNB to swap",
      "shared_across_steps": [2],
      "generation": {
        "method": "random",
        "min": 0.01,
        "max": 0.05,
        "decimals": 3
      }
    },
    "slippage": {
      "type": "number",
      "unit": "percent",
      "role": "parameter",
      "description": "Slippage tolerance percentage",
      "shared_across_steps": [2],
      "generation": {
        "method": "fixed",
        "value": 5
      }
    }
  },
  "interaction_config": {
    "optimal_steps": 2,
    "max_rounds_multiplier": 2,
    "comment": "max_rounds = optimal_steps * max_rounds_multiplier = 2 * 2 = 4"
  },
  "scoring_strategy": {
    "method": "atomic_validator_reuse",
    "description": "Directly reuse the atomic validator of the key operation - NO code duplication!",
    "key_operation_step": 2,
    "key_operation_id": "swap_exact_bnb_for_tokens",
    "key_operation_alias": "bnb_to_token_swap",
    "validator_class": "SwapExactBNBForTokensValidator",
    "note": "The validator will load SwapExactBNBForTokensValidator and call its validate() method directly"
  },
  "tags": ["query-write-verify", "defi", "swap"]
}

