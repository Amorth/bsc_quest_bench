{
  "id": "erc20_revoke_approval",
  "version": "2.0.0",
  "category": "basic_transactions",
  "subcategory": "erc20_operations",
  "difficulty": "medium",
  "title": "ERC20 Revoke Approval (Set Allowance to Zero)",
  "natural_language_templates": [
    "Revoke approval for spender address {spender_address} to spend my {token_symbol} tokens at {token_address}",
    "Cancel the authorization for address {spender_address} to use my {token_symbol} token (contract: {token_address})",
    "Remove the spending permission for {spender_address} on {token_symbol} token at {token_address}",
    "I want to revoke address {spender_address}'s access to my {token_symbol} (token address: {token_address})"
  ],
  "description": [
    "Revoke (cancel) a previously granted ERC20 token approval by setting the allowance to zero.",
    "",
    "Technical context:",
    "- This is a security best practice to prevent unauthorized token transfers",
    "- Revoking approval is done by calling approve(spender, 0)",
    "- Function signature: approve(address,uint256)",
    "- The amount should be 0 to revoke",
    "- Recommended gas limit: 60000",
    "",
    "Key considerations:",
    "- Create a Contract instance with token address and ERC20 ABI",
    "- Use encode the function call('approve', [spenderAddress, 0]) for the data field",
    "- Set transaction 'to' to the token contract address",
    "- Set transaction 'value' to 0 (not sending BNB)",
    "- After revoking, the allowance should be 0",
    "- Some tokens require setting allowance to 0 before changing to a new non-zero value (USDT issue)"
  ],
  "blockchain": {
    "chain": "BSC",
    "network": "mainnet"
  },
  "parameters": {
    "token_address": {
      "type": "address",
      "role": "contract",
      "description": "ERC20 token contract address",
      "generation": {
        "method": "from_list",
        "addresses": [
          "0x55d398326f99059fF775485246999027B3197955"
        ],
        "comment": "USDT on BSC Mainnet"
      }
    },
    "token_symbol": {
      "type": "string",
      "description": "Token symbol for natural language",
      "generation": {
        "method": "from_list",
        "values": [
          "USDT"
        ]
      },
      "role": "parameter"
    },
    "token_decimals": {
      "type": "integer",
      "description": "Token decimal places",
      "generation": {
        "method": "from_list",
        "values": [
          18
        ]
      },
      "role": "parameter"
    },
    "spender_address": {
      "type": "address",
      "role": "contract",
      "description": "Address to revoke approval from (typically a DeFi contract)",
      "generation": {
        "method": "from_list",
        "addresses": [
          "0x10ED43C718714eb63d5aA57B78B54704E256024E",
          "0x13f4EA83D0bd40E75C8222255bc855a974568Dd4",
          "0x1B81D678ffb9C0263b24A97847620C99d213eB14"
        ],
        "comment": "PancakeSwap Router, Venus Protocol, PancakeSwap V3 Router"
      }
    },
    "spender_name": {
      "type": "string",
      "description": "Human-readable name of the spender for natural language",
      "generation": {
        "method": "from_list",
        "values": [
          "PancakeSwap Router",
          "Venus Protocol",
          "PancakeSwap V3 Router"
        ]
      },
      "role": "parameter"
    }
  },
  "validation": {
    "pre_conditions": [
      {
        "type": "contract_exists",
        "description": "Token contract must exist",
        "address": "{token_address}"
      },
      {
        "type": "allowance_granted",
        "description": "There should be an existing approval to revoke",
        "token": "{token_address}",
        "spender": "{spender_address}",
        "note": "We will set an initial allowance before testing revoke"
      }
    ],
    "post_conditions": [
      {
        "type": "transaction_success",
        "weight": 0.3,
        "description": "Transaction executed successfully"
      },
      {
        "type": "contract_call",
        "weight": 0.2,
        "description": "Transaction calls correct token contract",
        "expected": "{token_address}"
      },
      {
        "type": "function_signature",
        "weight": 0.2,
        "description": "Correct approve function signature",
        "expected": "approve(address,uint256)"
      },
      {
        "type": "allowance_revoked",
        "weight": 0.3,
        "description": "Allowance set to zero",
        "token": "{token_address}",
        "spender": "{spender_address}",
        "expected_allowance": "0"
      }
    ]
  },
  "metadata": {
    "tags": [
      "erc20",
      "approve",
      "revoke",
      "security",
      "allowance",
      "intermediate"
    ],
    "estimated_gas": 60000,
    "requires_contract": true,
    "requires_token_balance": false,
    "contract_requirements": {
      "contract_type": "ERC20",
      "required_functions": [
        "approve",
        "allowance"
      ],
      "note": "Revoking approval is a security best practice"
    }
  }
}
