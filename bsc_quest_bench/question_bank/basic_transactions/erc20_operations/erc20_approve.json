{
  "id": "erc20_approve",
  "title": "ERC20 Token Approval",
  "difficulty": "easy",
  "category": "basic_transactions",
  "subcategory": "erc20_operations",
  "description": [
    "Approve a spender (Router or Contract) to spend your ERC20 tokens. This is a prerequisite for many DeFi operations like swapping or adding liquidity.",
    "",
    "The approve function sets the allowance that a spender can use on behalf of the token owner.",
    "",
    "Key Points:",
    "- Function: approve(address spender, uint256 amount)",
    "- Sets allowance for spender to transfer tokens on your behalf",
    "- Does not transfer tokens, only grants permission",
    "- Required before operations like swap, transferFrom, addLiquidity, etc.",
    "- Common spenders: PancakeSwap Router, Staking Contracts, etc.",
    "",
    "Transaction Requirements:",
    "- Call approve() on the ERC20 token contract",
    "- Pass spender address and amount to approve",
    "- Wait for transaction confirmation",
    "- No BNB value needed (not payable)",
    "- Gas: ~50,000",
    "",
    "Example Workflow:",
    "1. Connect to ERC20 token contract",
    "2. Call approve(spenderAddress, amountInWei)",
    "3. Wait for confirmation",
    "4. Verify allowance was set correctly"
  ],
  "tags": [
    "erc20",
    "approve",
    "allowance",
    "defi",
    "prerequisite"
  ],
  "parameters": {
    "token_address": {
      "type": "address",
      "description": "ERC20 token contract address",
      "example": "0x55d398326f99059fF775485246999027B3197955",
      "generation": {
        "method": "fixed",
        "value": "0x55d398326f99059fF775485246999027B3197955"
      },
      "role": "receiver"
    },
    "token_symbol": {
      "type": "string",
      "description": "Token symbol for display",
      "generation": {
        "method": "fixed",
        "value": "USDT"
      },
      "role": "parameter"
    },
    "token_decimals": {
      "type": "integer",
      "description": "Token decimals (all BSC tokens use 18)",
      "example": 18,
      "generation": {
        "method": "fixed",
        "value": 18
      },
      "role": "parameter"
    },
    "spender_address": {
      "type": "address",
      "description": "Address to approve (spender)",
      "example": "0x10ED43C718714eb63d5aA57B78B54704E256024E",
      "generation": {
        "method": "fixed",
        "value": "0x10ED43C718714eb63d5aA57B78B54704E256024E"
      },
      "role": "address"
    },
    "spender_name": {
      "type": "string",
      "description": "Spender name for display",
      "generation": {
        "method": "fixed",
        "value": "PancakeSwap Router V2"
      },
      "role": "parameter"
    },
    "amount": {
      "type": "number",
      "description": "Amount to approve (in token units)",
      "example": 200.0,
      "generation": {
        "method": "random",
        "min": 100.0,
        "max": 500.0,
        "decimals": 2
      },
      "role": "transfer_amount"
    },
    "agent_address": {
      "type": "address",
      "description": "Agent address (token owner)",
      "dynamic": true,
      "generation": {
        "method": "from_env",
        "env_key": "test_address"
      },
      "role": "address"
    },
    "chain_id": {
      "type": "integer",
      "description": "BSC Mainnet chain ID",
      "example": 56,
      "generation": {
        "method": "fixed",
        "value": 56
      },
      "role": "parameter"
    }
  },
  "natural_language_templates": [
    "Approve {spender_name} to spend {amount} {token_symbol} tokens from your account.",
    "Grant approval to {spender_name} for {amount} {token_symbol} tokens.",
    "Set allowance of {amount} {token_symbol} tokens for {spender_name}.",
    "Authorize {spender_name} to use up to {amount} {token_symbol} tokens on your behalf."
  ],
  "contracts": {
    "erc20_token": {
      "address": "dynamic",
      "name": "ERC20 Token (USDT/BUSD/CAKE)",
      "abi_functions": [
        "function approve(address spender, uint256 amount) external returns (bool)",
        "function allowance(address owner, address spender) external view returns (uint256)",
        "function balanceOf(address account) external view returns (uint256)"
      ]
    },
    "spender_contract": {
      "address": "dynamic",
      "name": "Spender Contract (Router/Pool)",
      "description": "The contract that will be approved to spend tokens"
    }
  },
  "expected_behavior": {
    "transaction_count": 1,
    "state_changes": [
      "Allowance for spender increases by approved amount",
      "Token balance remains unchanged (approve does not transfer)",
      "Approval event is emitted"
    ],
    "gas_estimate": 50000
  },
  "validation_criteria": {
    "transaction_success": {
      "weight": 30,
      "description": "Transaction executed successfully without reverting"
    },
    "correct_function_called": {
      "weight": 20,
      "description": "Called approve(address,uint256) with correct selector"
    },
    "allowance_set_correctly": {
      "weight": 40,
      "description": "Allowance increased by the approved amount"
    },
    "no_token_transfer": {
      "weight": 10,
      "description": "Token balance unchanged (approve does not transfer)"
    }
  },
  "hints": [
    "Use the ERC20 approve function: approve(address spender, uint256 amount)",
    "Convert the amount to wei units using token decimals (multiply by 10^18)",
    "The spender address should be the contract that will use your tokens",
    "No BNB value should be sent with this transaction (not payable)",
    "After approval, use allowance() to verify: allowance(owner, spender)"
  ],
  "common_mistakes": [
    "Forgetting to convert amount to wei (multiply by 10^decimals)",
    "Sending BNB value with approve transaction (not needed)",
    "Approving the token address instead of the spender address",
    "Not waiting for transaction confirmation before checking allowance",
    "Using transfer() instead of approve()"
  ],
  "references": [
    "https://docs.openzeppelin.com/contracts/4.x/api/token/erc20#IERC20-approve-address-uint256-",
    "https://eips.ethereum.org/EIPS/eip-20"
  ],
  "test_script_template": "erc20_approve.ts",
  "version": "2.0.0",
  "blockchain": {
    "chain": "BSC",
    "network": "mainnet"
  }
}
