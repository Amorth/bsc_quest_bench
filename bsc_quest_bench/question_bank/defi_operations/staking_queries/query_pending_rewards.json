{
  "id": "query_pending_rewards",
  "category": "defi_operations",
  "subcategory": "staking_queries",
  "difficulty": "medium",
  "title": "Query Pending Rewards",
  "description": "Query the pending rewards earned by a user in a staking pool. This involves calling the SimpleRewardPool contract's pendingReward function to retrieve the accumulated rewards that can be harvested. Rewards accumulate over time based on the user's staked amount and the pool's reward rate.",
  "natural_language_templates": [
    "Query the pending rewards for address {{query_address}} in the SimpleRewardPool",
    "Check how much rewards {{query_address}} has earned in the reward pool at {{pool_address}}",
    "Get the accumulated rewards for user {{query_address}} from the SimpleRewardPool contract",
    "Retrieve pending CAKE rewards for address {{query_address}} that can be harvested"
  ],
  "blockchain": "bsc",
  "parameters": {
    "pool_address": {
      "type": "address",
      "description": "SimpleRewardPool contract address",
      "generation": {
        "method": "from_env",
        "env_key": "simple_reward_pool_address"
      }
    },
    "query_address": {
      "type": "address",
      "description": "User address to query pending rewards for",
      "generation": {
        "method": "random"
      }
    },
    "expected_pending_rewards": {
      "type": "number",
      "description": "Expected pending rewards amount (in token units, not wei)",
      "generation": {
        "method": "random",
        "min": 0.1,
        "max": 50,
        "decimals": 3
      }
    },
    "reward_token_decimals": {
      "type": "integer",
      "description": "Reward token decimals (CAKE uses 18 decimals)",
      "generation": {
        "method": "fixed",
        "value": 18
      }
    }
  },
  "validation": {
    "type": "query",
    "rules": [
      {
        "field": "query_execution",
        "condition": "success",
        "error_message": "Failed to query pending rewards",
        "weight": 30
      },
      {
        "field": "return_format",
        "condition": "has_required_fields",
        "required_fields": ["pending_rewards"],
        "error_message": "Missing required fields in query result",
        "weight": 30
      },
      {
        "field": "pending_rewards_correctness",
        "condition": "matches_expected",
        "tolerance_percent": 5,
        "error_message": "Pending rewards do not match expected value (allowing 5% tolerance for time-based accumulation)",
        "weight": 40
      }
    ]
  },
  "metadata": {
    "tags": ["defi", "staking", "farming", "rewards", "query", "pendingReward"],
    "estimated_gas": 0,
    "prerequisites": ["stake_single_token", "stake_lp_tokens"],
    "related_questions": ["query_staked_amount", "harvest_rewards"],
    "learning_objectives": [
      "Understand how to query pending rewards from staking pools",
      "Learn to call pendingReward function to get accumulated rewards",
      "Master handling time-based reward accumulation",
      "Understand the difference between staked amount and earned rewards",
      "Learn proper unit conversion for reward tokens"
    ],
    "operation_type": "query",
    "notes": [
      "Rewards accumulate over time, so the exact value may vary slightly",
      "A 5% tolerance is used to account for time-based accumulation during test execution",
      "The pendingReward function is a view function and does not change state"
    ]
  }
}

