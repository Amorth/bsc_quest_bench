{
  "id": "swap_exact_tokens_for_tokens",
  "version": "2.0.0",
  "category": "defi_operations",
  "subcategory": "pancakeswap_swap",
  "difficulty": "medium",
  "title": "PancakeSwap Swap - Token to Token",
  "natural_language_templates": [
    "Swap {amount_in} {token_in_symbol} for {token_out_symbol} on PancakeSwap",
    "Exchange {amount_in} {token_in_symbol} to {token_out_symbol} using PancakeSwap Router",
    "Convert {amount_in} {token_in_symbol} tokens to {token_out_symbol} through PancakeSwap V2",
    "Trade {amount_in} {token_in_symbol} for {token_out_symbol} on PancakeSwap with {slippage}% slippage tolerance"
  ],
  "description": [
    "Swap one ERC20 token for another using PancakeSwap V2 Router's swapExactTokensForTokens function.",
    "",
    "Technical context:",
    "- PancakeSwap V2 Router (BSC Mainnet): 0x10ED43C718714eb63d5aA57B78B54704E256024E",
    "- Function signature: swapExactTokensForTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external returns (uint[] memory amounts)",
    "- This function requires prior token approval to the Router contract",
    "- The swap follows Uniswap V2 AMM (Automated Market Maker) model: x * y = k",
    "- Function selector: 0x38ed1739",
    "- Recommended gas limit: 200000",
    "",
    "Key considerations:",
    "- MUST approve input tokens to Router before calling swap function",
    "- amountIn: Exact amount of input tokens to swap",
    "- amountOutMin: Minimum amount of output tokens to receive (slippage protection)",
    "- path: Array of token addresses for the swap route",
    "- to: Recipient address (usually the sender/agent address)",
    "- deadline: Unix timestamp after which the transaction will revert",
    "",
    "Swap path considerations:",
    "- Direct path: [TOKEN_IN, TOKEN_OUT] if liquidity pool exists",
    "- Multi-hop path: [TOKEN_IN, WBNB, TOKEN_OUT] if direct pool doesn't exist or has low liquidity",
    "- WBNB address on BSC: 0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c",
    "- Most token pairs route through WBNB for better liquidity",
    "",
    "Two-step process:",
    "1. Call approve(router, amountIn) on the input token contract",
    "2. Call swapExactTokensForTokens on the router contract",
    "",
    "Slippage protection:",
    "- Calculate amountOutMin using getAmountsOut or apply a percentage (2-5% typical)",
    "- Formula: amountOutMin = expectedOutput * (1 - slippagePercent)",
    "- For testing, can use 0 for amountOutMin (accepts any output)",
    "",
    "Success criteria:",
    "- Transaction executes successfully",
    "- Correct PancakeSwap Router is called",
    "- Input token balance decreases by amountIn",
    "- Output token balance increases by at least amountOutMin"
  ],
  "blockchain": {
    "chain": "BSC",
    "network": "mainnet"
  },
  "parameters": {
    "router_address": {
      "type": "address",
      "role": "contract",
      "description": "PancakeSwap V2 Router contract address",
      "generation": {
        "method": "fixed",
        "value": "0x10ED43C718714eb63d5aA57B78B54704E256024E"
      }
    },
    "token_in_address": {
      "type": "address",
      "role": "token_in",
      "description": "Input token to swap (USDT by default)",
      "generation": {
        "method": "fixed",
        "value": "0x55d398326f99059fF775485246999027B3197955",
        "comment": "USDT on BSC"
      }
    },
    "token_in_symbol": {
      "type": "string",
      "role": "display",
      "description": "Input token symbol for display",
      "generation": {
        "method": "fixed",
        "value": "USDT"
      }
    },
    "token_in_decimals": {
      "type": "integer",
      "role": "calculation",
      "description": "Input token decimal places",
      "generation": {
        "method": "fixed",
        "value": 18
      }
    },
    "token_out_address": {
      "type": "address",
      "role": "token_out",
      "description": "Output token to receive (BUSD by default)",
      "generation": {
        "method": "fixed",
        "value": "0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56",
        "comment": "BUSD on BSC"
      }
    },
    "token_out_symbol": {
      "type": "string",
      "role": "display",
      "description": "Output token symbol for display",
      "generation": {
        "method": "fixed",
        "value": "BUSD"
      }
    },
    "token_out_decimals": {
      "type": "integer",
      "role": "calculation",
      "description": "Output token decimal places",
      "generation": {
        "method": "fixed",
        "value": 18
      }
    },
    "wbnb_address": {
      "type": "address",
      "role": "intermediate_token",
      "description": "WBNB address (for multi-hop routing)",
      "generation": {
        "method": "fixed",
        "value": "0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c"
      }
    },
    "amount_in": {
      "type": "number",
      "unit": "token",
      "role": "swap_amount",
      "description": "Amount of input tokens to swap",
      "generation": {
        "method": "random",
        "min": 0.5,
        "max": 5.0,
        "decimals": 2
      }
    },
    "slippage": {
      "type": "number",
      "unit": "percent",
      "role": "slippage_tolerance",
      "description": "Slippage tolerance percentage",
      "generation": {
        "method": "fixed",
        "value": 5.0
      }
    }
  },
  "validation": {
    "pre_conditions": [
      {
        "type": "token_balance_check",
        "description": "Agent must have sufficient input token balance"
      }
    ],
    "post_conditions": [
      {
        "type": "transaction_success",
        "weight": 0.2,
        "description": "Transaction executed successfully"
      },
      {
        "type": "token_approval",
        "weight": 0.15,
        "address": "{router_address}",
        "description": "Input token approved to Router (or approval check passed)"
      },
      {
        "type": "contract_called",
        "weight": 0.1,
        "address": "{router_address}",
        "description": "Correct PancakeSwap Router called"
      },
      {
        "type": "function_selector",
        "weight": 0.1,
        "selector": "0x38ed1739",
        "description": "Correct function swapExactTokensForTokens called"
      },
      {
        "type": "token_balance_decrease",
        "weight": 0.2,
        "token": "{token_in_address}",
        "expected_decrease": "{amount_in}",
        "tolerance": "0",
        "description": "Input token balance decreased by swap amount"
      },
      {
        "type": "token_balance_increase",
        "weight": 0.25,
        "token": "{token_out_address}",
        "min_increase": 0,
        "description": "Output token balance increased (received output tokens)"
      }
    ]
  },
  "metadata": {
    "tags": [
      "pancakeswap",
      "swap",
      "dex",
      "amm",
      "defi",
      "token-to-token",
      "approval-required",
      "multi-hop"
    ],
    "estimated_gas": 200000,
    "requires_contract": true,
    "requires_approval": true,
    "network": "mainnet",
    "dex": "PancakeSwap V2",
    "swap_type": "exact_input",
    "difficulty_notes": [
      "Requires understanding of token approval mechanism",
      "Two-step process: approve + swap",
      "Requires understanding of swap paths",
      "May need multi-hop routing through WBNB",
      "Must track two different token balances"
    ]
  }
}
