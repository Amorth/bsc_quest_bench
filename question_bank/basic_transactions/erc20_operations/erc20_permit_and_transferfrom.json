{
  "id": "erc20_permit_and_transferfrom",
  "category": "basic_transactions",
  "subcategory": "erc20_operations",
  "difficulty": "hard",
  "title": "ERC20 Permit and TransferFrom (EIP-2612)",
  "description": [
    "Use EIP-2612 permit signature to authorize token spending, then execute transferFrom to transfer tokens from another address.",
    "",
    "Technical context:",
    "- EIP-2612 extends ERC20 with permit() function for gasless approvals",
    "- Function signatures:",
    "  - permit(address owner, address spender, uint256 value, uint256 deadline, uint8 v, bytes32 r, bytes32 s)",
    "  - transferFrom(address from, address to, uint256 amount)",
    "- The permit function uses EIP-712 typed signatures",
    "- Signature components: v (recovery id), r and s (signature parts)",
    "- deadline: timestamp after which the signature is no longer valid",
    "- nonces: incremental counter to prevent replay attacks",
    "- Recommended gas limit: 150000",
    "",
    "Key considerations:",
    "- This is a meta-transaction pattern (signature-based approval)",
    "- The signer authorizes spending without sending a transaction",
    "- After permit, allowance is set and transferFrom can be called",
    "- Must use a token that implements EIP-2612 (Permit)",
    "- Most standard tokens (USDT, USDC) may not support Permit on BSC",
    "- For testing, requires a custom EIP-2612 compliant token",
    "",
    "Implementation steps:",
    "1. Generate EIP-712 signature for permit",
    "2. Call permit() with signature to set allowance",
    "3. Call transferFrom() to transfer tokens from owner to recipient"
  ],
  "natural_language_templates": [
    "Use permit signature to approve and transfer {amount} {token_symbol} from {owner_address} to {to_address}",
    "Execute permit-based transfer of {amount} {token_symbol} tokens from {owner_address} to {to_address} at {token_address}",
    "Transfer {amount} {token_symbol} from {owner_address} to {to_address} using EIP-2612 permit at {token_address}"
  ],
  "parameters": {
    "token_address": {
      "type": "address",
      "role": "token_contract",
      "description": "EIP-2612 compliant token contract address",
      "generation": {
        "method": "from_env",
        "env_key": "eip2612_token_address",
        "comment": "Use dynamically deployed EIP-2612 token from environment"
      }
    },
    "token_symbol": {
      "type": "string",
      "role": "display",
      "description": "Token symbol for display",
      "generation": {
        "method": "fixed",
        "value": "TPMT"
      }
    },
    "token_decimals": {
      "type": "number",
      "role": "calculation",
      "description": "Token decimal places",
      "generation": {
        "method": "fixed",
        "value": 18
      }
    },
    "owner_address": {
      "type": "address",
      "role": "token_owner",
      "description": "Address that owns the tokens (must sign permit)",
      "generation": {
        "method": "from_env",
        "env_key": "test_address",
        "comment": "Use test account as owner"
      }
    },
    "to_address": {
      "type": "address",
      "role": "recipient",
      "description": "Final recipient of tokens",
      "generation": {
        "method": "random"
      }
    },
    "amount": {
      "type": "number",
      "unit": "token",
      "role": "transfer_amount",
      "description": "Amount of tokens to transfer",
      "generation": {
        "method": "random",
        "min": 1.0,
        "max": 100.0,
        "decimals": 2
      }
    }
  },
  "preconditions": [
    {
      "type": "balance_check",
      "address": "{owner_address}",
      "token": "{token_address}",
      "min_balance": "{amount}"
    }
  ],
  "validation_rules": [
    {
      "type": "transaction_success",
      "weight": 0.3,
      "description": "Permit or transferFrom transaction executed successfully"
    },
    {
      "type": "token_balance_change",
      "address": "{owner_address}",
      "token": "{token_address}",
      "expected_change": "-{amount}",
      "tolerance": "0",
      "weight": 0.35,
      "description": "Owner balance decreased correctly"
    },
    {
      "type": "token_balance_change",
      "address": "{to_address}",
      "token": "{token_address}",
      "expected_change": "+{amount}",
      "tolerance": "0",
      "weight": 0.35,
      "description": "Recipient balance increased correctly"
    }
  ],
  "metadata": {
    "tags": [
      "eip-2612",
      "permit",
      "signature",
      "meta-transaction",
      "gasless-approval",
      "transferFrom",
      "advanced"
    ],
    "estimated_gas": 150000,
    "requires_contract": true,
    "requires_signature": true,
    "network": "mainnet",
    "erc_standard": "EIP-2612",
    "known_limitations": [
      "Most standard ERC20 tokens do NOT support EIP-2612 Permit",
      "Requires EIP-712 signature generation",
      "Complex implementation involving cryptographic signatures",
      "For testing, requires custom EIP-2612 compliant token",
      "BSC may have limited native support for Permit"
    ],
    "implementation_status": "development",
    "requires_custom_token": true,
    "difficulty_notes": [
      "Requires understanding of EIP-712 typed data signatures",
      "Must handle nonce management",
      "Must construct proper domain separator",
      "Two-step process: permit + transferFrom"
    ]
  }
}

